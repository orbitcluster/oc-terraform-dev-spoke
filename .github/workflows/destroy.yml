---
name: "dev-spoke-destroy"

on:
  workflow_dispatch:
    inputs:
      component:
        description: "Component to destroy"
        required: true
        type: choice
        options:
          - eks_infra
          - eks_essential_addons
          - eks_custom_addons
          - all
      confirm_destroy:
        description: "Type 'destroy' to confirm"
        required: true
        type: string

permissions:
  contents: read
  id-token: write
  issues: write

jobs:
  validate-input:
    runs-on: ubuntu-latest
    steps:
      - name: Validate confirmation
        if: ${{ github.event.inputs.confirm_destroy != 'destroy' }}
        run: |
          echo "::error::You must type 'destroy' to confirm the destruction"
          exit 1
      - name: Display destroy target
        run: |
          echo "ðŸŽ¯ Component to destroy: ${{ github.event.inputs.component }}"

  dev-spoke-destroy:
    needs: validate-input
    uses: "orbitcluster/oc-terraform-module-eks-setup/.github/workflows/destroy.yml@v2.14.1"
    with:
      tfvar_file_path: "dev-spoke.tfvars"
      bucket_name: "oc-backend-dev-spoke"
      approvers: "dilipsamanta, mav-sk"
      master_s3_directory: "oc-eks-dev-spoke"
      component: ${{ github.event.inputs.component }}
      module_ref: "v2.14.1"
    secrets: inherit
